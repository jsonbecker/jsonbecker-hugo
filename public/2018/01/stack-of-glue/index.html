<html>
<head>
  <link href = "https://micro.blog/jsonbecker" rel = "me" />
  <link href = "/css/post.css" rel = "stylesheet" type = "text/css">
  
  <link rel="stylesheet" href="/css/tomorrow-night-bright.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css">
  <script src="/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
<body>
  <div class = "site">
    <header class = "title-bar">
      <nav>
        <span class = "site-title"> <a href = "http://www.json.blog">json.blog </a></span>
        <span class = "nav">
          <a href = "https://jsonbecker.com">About</a>
          <a href = "https://micro.json.blog" rel="me">Micro</a>
          <a href = "https://www.github.com/jsonbecker">Github</a>
        </span>
      </nav>
    </header>
  <main> 


 <article class = "h-entry">
  <div class = "post-title">
    <time class = "date dt-published">January 25, 2018</time> 
    <h1 class = "p-name"><a class = "u-url" href = "http://www.json.blog/2018/01/stack-of-glue/">Stack of Glue</a></h1>
  </div>

 <div class = "post-content e-content">
   <p>I have some text, but I want the content of that text to be dynamic based on data. This is a case for string interpolation. Lots of languages have the ability to write something like</p>

<pre><code class="language-ruby">pet = &quot;dog&quot;
puts &quot;This is my {#pet}&quot;
</code></pre>

<pre><code class="language-python">pet = &quot;dog&quot;
print(f&quot;This is my {pet}&quot;)
</code></pre>

<p>There have been ways to do this in R, but I&rsquo;ve mostly hated them until <code>glue</code> came along. Using <code>glue</code> in R should look really familiar now:</p>

<pre><code class="language-r">pet &lt;- &quot;dog&quot;
glue(&quot;This is my {pet}&quot;)
</code></pre>

<p>Awesome! Now I have a way to make text bend to my bidding using data. But this is pretty simple, and we could have just used something like <code>paste(&quot;This is my&quot;, pet)</code> and been done with it.</p>

<p>Let me provide a little motivation in the form of <code>data.frame</code>s, <code>glue_data</code>, and some <code>purrr</code>.</p>

<p>Pretend we have a field in a database called <code>notes</code>. I want to set the <code>notes</code> for each entity to follow the same pattern, but use other data to fill in the blanks. Like maybe something like this:</p>

<pre><code class="language-r">notes &lt;- &quot;This item price is valid through {end_date} and will then increase {price_change} to {new_price}.&quot;
</code></pre>

<p>This is a terrible contrived example, but we can imagine displaying this note to someone with different content for each item. Now in most scenarios, the right thing to do for an application is to produce this content dynamically based on what&rsquo;s in the database, but let&rsquo;s pretend no one looked far enough ahead to store this data or like notes can serve lots of different purposes using different data. So there is no place for the application to find <code>end_date</code>, <code>price_change</code>, or <code>new_price</code> in its database. Instead, this was something prepared by sales in Excel yesterday and they want these notes added to all items to warn their customers.</p>

<p>Here&rsquo;s how to take a table that has <code>item_id</code>, <code>end_date</code>, <code>price_change</code>, and <code>new_price</code> as columns and turn it into a table with <code>item_id</code>, and <code>notes</code> as columns, with your properly formatted note for each item to be updated in a database.</p>

<pre><code class="language-r">library(glue)
library(purrr)

item_notes &lt;- data.frame(
  item_id = seq_len(10),
  end_date = c(rep(as.Date('2018-03-01', format = '%Y-%m-%d'), 5),
               rep(as.Date('2018-03-05', format = '%Y-%m-%d'), 3),
               rep(as.Date('2018-03-09', format = '%Y-%m-%d'), 2)),
  price_change = sample(x = seq_len(5),replace = TRUE,size = 10),
  new_price = sample(x = 10:20,replace = TRUE,size = 10)
)

template &lt;- &quot;This item price is valid through {end_date} and will then increase {price_change} to {new_price}.&quot;

map_chr(split(item_notes, item_notes$item_id), 
    glue_data, 
    template) %&gt;% 
stack() %&gt;% 
rename(item_id = ind,
       notes = values)
</code></pre>

<p>What&rsquo;s going on here? First, I want to apply my <code>glue</code> technique to rows of a <code>data.frame</code>,
so I <code>split</code> the data into a <code>list</code> using <code>item_id</code> as the identifier. That&rsquo;s because at the end of all this I want to preserve that id to match back up in a database. <sup class="footnote-ref" id="fnref:rownames"><a href="#fn:rownames">1</a></sup> The function <code>glue_data</code> works like <code>glue</code>, but it accepts things that are &ldquo;listish&rdquo; as it&rsquo;s first argument (like <code>data.frames</code> and named <code>lists</code>). So with handy <code>map</code> over my newly created <code>list</code> of &ldquo;listish&rdquo; data, I create a named <code>list</code> with the text I wanted to generate. I then use a base R function that&rsquo;s new to me <code>stack</code>, which will take a list and make each element a row in a <code>data.frame</code> with <code>ind</code> as the name of the <code>list</code> element and <code>values</code> as the value.</p>

<p>Now I&rsquo;ve got a nice <code>data.frame</code>, ready to be joined with any table that has <code>item_id</code> so it can have the attached note!</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:rownames">You can split on <code>row.names</code> if you don&rsquo;t have a similar identifer and just want to go from <code>data.frame</code> to a <code>list</code> of your rows.
 <a class="footnote-return" href="#fnref:rownames"><sup>[return]</sup></a></li>
</ol>
</div>

 </div>
 <span class = "h-card">
    <a class ="p-author u-url"a href="http://jsonbecker.com"> Jason Becker</a>
  </span>
</article>


  </main>
  <footer> 
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-40920108-1", 'auto');
  ga('send', 'pageview');
</script>
</footer>
    </div>
    </body>
</html>
